<template>
  <div class="bg-yellow-300 flex justify-center items-center w-screen h-screen">
    <div
      v-show="streaming"
      class="absolute top-10 left-10 rounded-lg shadow-md max-w-lg z-50 aspect-video overflow-hidden"
    >
      <video class="relative" id="video"></video>
      <div
        class="w-full h-4 z-50 absolute bottom-12 flex justify-center items-center gap-x-4"
      >
        <div
          class="w-10 h-10 aspect-square rounded-full bg-white bg-opacity-25 flex justify-center items-center"
        >
          <svg
            width="16"
            height="17"
            viewBox="0 0 16 17"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M0.666722 6.72985C0.489896 6.72985 0.320313 6.65961 0.195279 6.53458C0.0702439 6.40954 0 6.23996 0 6.06313V0.730687C0 0.553861 0.0702439 0.384278 0.195279 0.259243C0.320313 0.134209 0.489896 0.0639648 0.666722 0.0639648H6.0005C6.17733 0.0639648 6.34691 0.134209 6.47194 0.259243C6.59698 0.384278 6.66722 0.553861 6.66722 0.730687V6.06313C6.66722 6.23996 6.59698 6.40954 6.47194 6.53458C6.34691 6.65961 6.17733 6.72985 6.0005 6.72985H0.666722ZM10.0008 6.72985C9.82401 6.72985 9.65442 6.65961 9.52939 6.53458C9.40435 6.40954 9.33411 6.23996 9.33411 6.06313V0.730687C9.33411 0.553861 9.40435 0.384278 9.52939 0.259243C9.65442 0.134209 9.82401 0.0639648 10.0008 0.0639648H15.3333C15.5101 0.0639648 15.6797 0.134209 15.8047 0.259243C15.9298 0.384278 16 0.553861 16 0.730687V6.06313C16 6.23996 15.9298 6.40954 15.8047 6.53458C15.6797 6.65961 15.5101 6.72985 15.3333 6.72985H10.0008ZM0.666722 16.064C0.489896 16.064 0.320313 15.9937 0.195279 15.8687C0.0702439 15.7437 0 15.5741 0 15.3972V10.0635C0 9.88664 0.0702439 9.71706 0.195279 9.59202C0.320313 9.46699 0.489896 9.39674 0.666722 9.39674H6.0005C6.17733 9.39674 6.34691 9.46699 6.47194 9.59202C6.59698 9.71706 6.66722 9.88664 6.66722 10.0635V15.3972C6.66722 15.5741 6.59698 15.7437 6.47194 15.8687C6.34691 15.9937 6.17733 16.064 6.0005 16.064H0.666722ZM10.0008 16.064C9.82401 16.064 9.65442 15.9937 9.52939 15.8687C9.40435 15.7437 9.33411 15.5741 9.33411 15.3972V10.0635C9.33411 9.88664 9.40435 9.71706 9.52939 9.59202C9.65442 9.46699 9.82401 9.39674 10.0008 9.39674H15.3333C15.5101 9.39674 15.6797 9.46699 15.8047 9.59202C15.9298 9.71706 16 9.88664 16 10.0635V15.3972C16 15.5741 15.9298 15.7437 15.8047 15.8687C15.6797 15.9937 15.5101 16.064 15.3333 16.064H10.0008Z"
              fill="white"
            />
          </svg>
        </div>
        <div
          class="w-10 h-10 aspect-square rounded-full bg-white bg-opacity-25 flex justify-center items-center"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M5.727 4.31296L1.707 0.292958L0.293 1.70696L18.293 19.707L19.707 18.293L17.687 16.273C19.1861 14.5275 20.0068 12.3008 19.999 9.99996C19.999 5.90896 17.527 2.54696 14 0.999958V2.99996C16.387 4.38596 17.999 7.04696 17.999 9.99996C17.9939 11.7765 17.4069 13.5025 16.328 14.914L15.042 13.628C15.644 12.536 16 11.19 16 9.99996C16 8.22896 15.225 6.09996 14 4.99996V12.586L12 10.586V0.131958L5.727 4.31296ZM2 15H4.697L12 19.868V16.121L1.102 5.22296C0.771889 5.3882 0.4941 5.64179 0.299543 5.95552C0.104986 6.26925 0.00129227 6.6308 0 6.99996V13C0 14.103 0.897 15 2 15Z"
              fill="white"
            />
          </svg>
        </div>
        <div
          class="w-12 h-12 aspect-square rounded-full bg-red-500 flex justify-center items-center"
          @click="streaming = false"
        >
          <svg
            width="24"
            height="16"
            viewBox="0 0 36 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M18.2125 6.83087C15.2399 6.75766 12.2872 7.33614 9.562 8.52571L8.93407 13.3026C8.90713 13.4356 8.84044 13.5573 8.74282 13.6516C8.64519 13.7458 8.52124 13.8082 8.38737 13.8305L0.21908 15.4489C-0.0830701 15.5186 -0.397282 15.5171 -0.698736 15.4444C-1.00019 15.3718 -1.28063 15.2301 -1.5179 15.0305C-1.75517 14.8308 -1.94278 14.5788 -2.0659 14.2942C-2.18902 14.0096 -2.24428 13.7003 -2.22731 13.3906L-2.11857 8.78151C-2.10309 8.12134 -1.9244 7.47528 -1.59847 6.90098C-1.27253 6.32668 -0.809488 5.842 -0.250654 5.4902C5.31256 1.96913 11.7542 0.0842083 18.3379 0.0508737C24.8772 0.123457 31.2549 2.09206 36.6973 5.71788C37.2386 6.07982 37.6772 6.57545 37.9706 7.15673C38.264 7.73801 38.4023 8.38522 38.3721 9.03566L38.2048 13.7569C38.2037 14.0586 38.1343 14.3561 38.0018 14.6272C37.8694 14.8983 37.6774 15.1359 37.4401 15.3222C37.2028 15.5085 36.9265 15.6388 36.6318 15.7032C36.337 15.7676 36.0315 15.7645 35.7382 15.6941L27.586 13.9605C27.4528 13.9383 27.3302 13.8739 27.2364 13.7768C27.1426 13.6796 27.0825 13.5549 27.065 13.421L26.7101 8.63408C24.0465 7.40982 21.1438 6.79385 18.2125 6.83087V6.83087Z"
              fill="white"
            />
          </svg>
        </div>
        <div
          class="w-10 h-10 aspect-square rounded-full bg-white bg-opacity-25 flex justify-center items-center"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_313_51)">
              <path
                d="M13 8.00001C13 8.56401 12.906 9.10701 12.734 9.61301L11.92 8.79901C11.9733 8.53602 12.0001 8.26835 12 8.00001V7.00001C12 6.8674 12.0527 6.74023 12.1464 6.64646C12.2402 6.55269 12.3674 6.50001 12.5 6.50001C12.6326 6.50001 12.7598 6.55269 12.8536 6.64646C12.9473 6.74023 13 6.8674 13 7.00001V8.00001ZM8 12C8.818 12 9.578 11.755 10.212 11.333L10.93 12.052C10.2162 12.5697 9.37751 12.8882 8.5 12.975V15H11.5C11.6326 15 11.7598 15.0527 11.8536 15.1465C11.9473 15.2402 12 15.3674 12 15.5C12 15.6326 11.9473 15.7598 11.8536 15.8536C11.7598 15.9473 11.6326 16 11.5 16H4.5C4.36739 16 4.24021 15.9473 4.14645 15.8536C4.05268 15.7598 4 15.6326 4 15.5C4 15.3674 4.05268 15.2402 4.14645 15.1465C4.24021 15.0527 4.36739 15 4.5 15H7.5V12.975C6.26668 12.8511 5.12338 12.2734 4.29188 11.3542C3.46038 10.4349 2.99998 9.23954 3 8.00001V7.00001C3 6.8674 3.05268 6.74023 3.14645 6.64646C3.24021 6.55269 3.36739 6.50001 3.5 6.50001C3.63261 6.50001 3.75979 6.55269 3.85355 6.64646C3.94732 6.74023 4 6.8674 4 7.00001V8.00001C4 9.06088 4.42143 10.0783 5.17157 10.8284C5.92172 11.5786 6.93913 12 8 12ZM11 3.00001V7.87901L5.158 2.03701C5.38694 1.36425 5.8472 0.794569 6.45683 0.429379C7.06647 0.0641881 7.78592 -0.0728099 8.4871 0.0427739C9.18829 0.158358 9.8257 0.519022 10.2859 1.06056C10.746 1.6021 10.9991 2.28937 11 3.00001V3.00001Z"
                fill="white"
              />
              <path
                d="M9.486 10.607L5 6.12V8C4.99984 8.52531 5.13763 9.04146 5.39957 9.49681C5.66152 9.95216 6.03844 10.3307 6.49263 10.5947C6.94682 10.8586 7.46236 10.9987 7.98767 11.0009C8.51298 11.003 9.02965 10.8672 9.486 10.607V10.607ZM1.646 1.354L13.646 13.354L14.354 12.646L2.354 0.645996L1.646 1.354V1.354Z"
                fill="white"
              />
            </g>
            <defs>
              <clipPath id="clip0_313_51">
                <rect width="16" height="16" fill="white" />
              </clipPath>
            </defs>
          </svg>
        </div>
        <div
          class="w-10 h-10 aspect-square rounded-full bg-white bg-opacity-25 flex justify-center items-center"
        >
          <svg
            width="17"
            height="17"
            viewBox="0 0 17 17"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M8.61196 6.19644C8.04744 6.19644 7.5188 6.41545 7.11855 6.8157C6.72018 7.21596 6.49928 7.7446 6.49928 8.30911C6.49928 8.87362 6.72018 9.40226 7.11855 9.80252C7.5188 10.2009 8.04744 10.4218 8.61196 10.4218C9.17647 10.4218 9.70511 10.2009 10.1054 9.80252C10.5037 9.40226 10.7246 8.87362 10.7246 8.30911C10.7246 7.7446 10.5037 7.21596 10.1054 6.8157C9.90987 6.6187 9.67718 6.46251 9.42081 6.3562C9.16444 6.2499 8.88949 6.19559 8.61196 6.19644V6.19644ZM16.3962 10.6427L15.1614 9.58729C15.22 9.22857 15.2502 8.8623 15.2502 8.49791C15.2502 8.13353 15.22 7.76537 15.1614 7.40853L16.3962 6.35314C16.4895 6.27329 16.5562 6.16694 16.5876 6.04823C16.619 5.92951 16.6134 5.80407 16.5718 5.68857L16.5548 5.63948C16.215 4.68923 15.7058 3.80841 15.0519 3.0397L15.0179 3.00005C14.9385 2.90669 14.8327 2.83958 14.7144 2.80756C14.5961 2.77555 14.4709 2.78012 14.3553 2.82069L12.8222 3.36632C12.2558 2.90188 11.6252 2.5356 10.9418 2.28072L10.6453 0.677809C10.623 0.557057 10.5644 0.445967 10.4774 0.359299C10.3904 0.272631 10.2791 0.214488 10.1582 0.192593L10.1073 0.183153C9.12549 0.00568079 8.09087 0.00568079 7.10911 0.183153L7.05813 0.192593C6.93729 0.214488 6.82598 0.272631 6.73897 0.359299C6.65197 0.445967 6.59339 0.557057 6.57103 0.677809L6.27272 2.28827C5.59574 2.54519 4.96508 2.91057 4.40549 3.3701L2.8611 2.82069C2.74549 2.7798 2.62018 2.77506 2.50181 2.8071C2.38344 2.83913 2.27762 2.90643 2.19842 3.00005L2.16443 3.0397C1.51174 3.80923 1.00269 4.68983 0.661583 5.63948L0.644591 5.68857C0.559631 5.92457 0.629487 6.18889 0.820175 6.35314L2.07003 7.41986C2.0115 7.77481 1.98318 8.1373 1.98318 8.49602C1.98318 8.85852 2.0115 9.22102 2.07003 9.57219L0.823951 10.6389C0.730676 10.7188 0.663917 10.8251 0.632553 10.9438C0.601189 11.0625 0.606704 11.188 0.648367 11.3035L0.665359 11.3526C1.00709 12.3022 1.51118 13.1802 2.16821 13.9523L2.20219 13.992C2.28159 14.0854 2.38741 14.1525 2.50571 14.1845C2.62401 14.2165 2.74923 14.2119 2.86488 14.1714L4.40927 13.6219C4.97189 14.0845 5.59871 14.4508 6.2765 14.7038L6.5748 16.3142C6.59717 16.435 6.65574 16.5461 6.74275 16.6327C6.82975 16.7194 6.94107 16.7776 7.06191 16.7995L7.11288 16.8089C8.1043 16.9873 9.11961 16.9873 10.111 16.8089L10.162 16.7995C10.2828 16.7776 10.3942 16.7194 10.4812 16.6327C10.5682 16.5461 10.6267 16.435 10.6491 16.3142L10.9455 14.7113C11.629 14.4546 12.2596 14.0902 12.826 13.6257L14.359 14.1714C14.4746 14.2122 14.6 14.217 14.7183 14.185C14.8367 14.1529 14.9425 14.0856 15.0217 13.992L15.0557 13.9523C15.7127 13.1764 16.2168 12.3022 16.5586 11.3526L16.5755 11.3035C16.6567 11.0694 16.5869 10.8069 16.3962 10.6427ZM8.61196 11.6282C6.77871 11.6282 5.29285 10.1424 5.29285 8.30911C5.29285 6.47586 6.77871 4.99001 8.61196 4.99001C10.4452 4.99001 11.9311 6.47586 11.9311 8.30911C11.9311 10.1424 10.4452 11.6282 8.61196 11.6282Z"
              fill="white"
            />
          </svg>
        </div>
      </div>
    </div>

    <div
      class="phone overflow-hidden w-[360px] h-[800px] rounded-[20px] bg-white relative"
    >
      <!-- Area -->
      <div class="h-8 mx-4 flex justify-between items-center">
        <div class="text-xs">
          <span> {{ parseTime }}</span>
        </div>
        <div class="">
          <div class="flex items-center justify-between gap-x-2">
            <!-- Network -->
            <NetworkIcon :type="type" />

            <!-- Wifi -->
            <WifiIcon :rtt="rtt" />
            <!-- Battery -->
            <BatteryIcon :level="battery" :charging="charging" />
          </div>
        </div>
      </div>
      <!-- Header -->
      <div class="h-14 bg-yellow-500 px-4 flex items-center justify-between">
        <div class="flex gap-4 items-center">
          <!-- Arrow -->
          <svg
            width="16"
            height="14"
            viewBox="0 0 16 14"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M6.66731 1.42464L1.36401 6.72794L6.66731 12.0312M1.36401 6.72794H14.0919H1.36401Z"
              stroke="#00473E"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <div
            class="w-10 aspect-square rounded-full bg-slate-400 overflow-hidden"
          >
            <img
              class="w-full h-full object-cover"
              src="./assets/profile_pic.JPG"
              alt=""
            />
          </div>
          <span class="text-[#00473E] font-bold">Séréna</span>
        </div>
        <div class="flex items-center gap-4">
          <!-- TEL -->
          <svg
            width="32"
            height="32"
            viewBox="0 0 32 32"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M8.75687 8.46166L9.65032 7.77039C10.4883 7.12271 11.6795 7.2436 12.4336 8.05245L13.9354 9.66401C14.5888 10.3658 14.7487 11.4133 14.3307 12.2529L13.1649 14.5906C13.6429 15.5617 14.3453 16.4331 15.2711 17.2049C16.1567 17.9555 17.1838 18.5207 18.2917 18.8671L20.1706 17.3745C20.8824 16.8099 21.8789 16.7995 22.6408 17.349L24.4185 18.6282C25.3056 19.2673 25.6275 20.4761 25.1725 21.4569L24.6856 22.5078C24.2001 23.5539 23.2088 24.2308 22.0837 24.2827C19.426 24.4072 16.4296 22.996 13.0908 20.0503C9.74705 17.0999 7.90259 14.234 7.55968 11.4557C7.41512 10.2866 7.8699 9.14737 8.75687 8.46166Z"
              fill="#00473E"
              fill-opacity="0.95"
            />
          </svg>
          <!-- Search -->
          <svg
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M13.6041 12.4158L18.0875 16.8992C18.2451 17.0569 18.3335 17.2707 18.3335 17.4936C18.3334 17.7166 18.2447 17.9303 18.0871 18.0879C17.9294 18.2455 17.7155 18.334 17.4926 18.3339C17.2697 18.3338 17.0559 18.2452 16.8983 18.0875L12.415 13.6042C11.0747 14.6422 9.38937 15.1307 7.70174 14.9703C6.01412 14.8098 4.451 14.0125 3.33037 12.7405C2.20975 11.4685 1.61579 9.81734 1.66935 8.12295C1.7229 6.42856 2.41993 4.81821 3.61864 3.61949C4.81735 2.42078 6.4277 1.72375 8.12209 1.6702C9.81648 1.61665 11.4676 2.2106 12.7396 3.33123C14.0117 4.45185 14.809 6.01497 14.9694 7.7026C15.1299 9.39022 14.6414 11.0756 13.6033 12.4158H13.6041ZM8.3333 13.3333C9.65938 13.3333 10.9312 12.8065 11.8688 11.8689C12.8065 10.9312 13.3333 9.65941 13.3333 8.33332C13.3333 7.00724 12.8065 5.73547 11.8688 4.79779C10.9312 3.86011 9.65938 3.33332 8.3333 3.33332C7.00722 3.33332 5.73545 3.86011 4.79777 4.79779C3.86009 5.73547 3.3333 7.00724 3.3333 8.33332C3.3333 9.65941 3.86009 10.9312 4.79777 11.8689C5.73545 12.8065 7.00722 13.3333 8.3333 13.3333Z"
              fill="#00473E"
            />
          </svg>
          <!-- Options -->
          <svg
            width="18"
            height="18"
            viewBox="0 0 18 18"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M9.00092 7.02C8.74078 7.02 8.4832 7.07124 8.24286 7.17079C8.00253 7.27034 7.78416 7.41625 7.60021 7.60019C7.41627 7.78414 7.27036 8.00251 7.17081 8.24284C7.07126 8.48318 7.02002 8.74077 7.02002 9.0009C7.02002 9.26104 7.07126 9.51863 7.17081 9.75896C7.27036 9.99929 7.41627 10.2177 7.60021 10.4016C7.78416 10.5856 8.00253 10.7315 8.24286 10.831C8.4832 10.9306 8.74078 10.9818 9.00092 10.9818C9.52629 10.9817 10.0301 10.7729 10.4015 10.4013C10.7729 10.0297 10.9815 9.52582 10.9814 9.00045C10.9813 8.47508 10.7724 7.97128 10.4009 7.59988C10.0293 7.22847 9.52539 7.01988 9.00002 7.02H9.00092ZM9.00092 4.68C9.26094 4.67988 9.51839 4.62855 9.75856 4.52894C9.99874 4.42932 10.217 4.28338 10.4007 4.09944C10.5845 3.91549 10.7303 3.69715 10.8296 3.45688C10.929 3.21661 10.9801 2.95912 10.98 2.6991C10.9799 2.43908 10.9286 2.18164 10.829 1.94146C10.7293 1.70128 10.5834 1.48307 10.3995 1.29929C10.2155 1.11552 9.99717 0.969771 9.7569 0.870375C9.51663 0.77098 9.25914 0.719883 8.99912 0.720001C8.47399 0.72024 7.97046 0.929076 7.59931 1.30057C7.22816 1.67206 7.01978 2.17577 7.02002 2.7009C7.02026 3.22603 7.22909 3.72956 7.60058 4.10071C7.97208 4.47186 8.47579 4.68024 9.00092 4.68ZM9.00092 13.32C8.47555 13.32 7.9717 13.5287 7.60021 13.9002C7.22872 14.2717 7.02002 14.7755 7.02002 15.3009C7.02002 15.8263 7.22872 16.3301 7.60021 16.7016C7.9717 17.0731 8.47555 17.2818 9.00092 17.2818C9.52629 17.2818 10.0301 17.0731 10.4016 16.7016C10.7731 16.3301 10.9818 15.8263 10.9818 15.3009C10.9818 14.7755 10.7731 14.2717 10.4016 13.9002C10.0301 13.5287 9.52629 13.32 9.00092 13.32Z"
              fill="#00473E"
            />
          </svg>
        </div>
      </div>
      <!-- APP -->
      <div
        class="mt-6 mx-4 overflow-y-scroll h-3/4 flex flex-col items-baseline"
        id="msg-list"
      >
        <!-- Date -->
        <div class="w-full text-center text-xs">
          <span>{{ date }}</span>
        </div>
        <!-- Messages -->
        <MessagesList
          :messages="messages"
          :isProcessing="context.isProcessing"
        />
      </div>

      <!-- Footer -->
      <div
        class="absolute bottom-6 h-10 w-full flex justify-between items-center px-3"
      >
        <!-- Plus -->
        <svg
          width="18"
          height="18"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.04545 17.2585V0.0142038H9.70739V17.2585H8.04545ZM0.261364 9.47443V7.7983H17.4915V9.47443H0.261364Z"
            fill="#00332C"
          />
        </svg>

        <!-- Input -->
        <div
          class="px-4 py-[10px] rounded-[20px] w-[250px] border-black border flex justify-between items-center"
        >
          <div class="flex gap-x-2 items-center">
            <!-- Smiley -->
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M5.13873 2.725C6.09386 2.07541 7.16815 1.62136 8.29963 1.38904C9.43112 1.15672 10.5974 1.15073 11.7312 1.37141C12.865 1.5921 13.9439 2.03509 14.9057 2.67483C15.8674 3.31458 16.693 4.13842 17.3347 5.09882C17.9765 6.05923 18.4217 7.1372 18.6448 8.27055C18.8679 9.40389 18.8643 10.5702 18.6344 11.7022C18.4044 12.8341 17.9526 13.9094 17.305 14.8658C16.6574 15.8223 15.8269 16.6411 14.8612 17.275C12.9318 18.5645 10.5691 19.0346 8.29302 18.5821C6.01691 18.1295 4.01381 16.7913 2.72436 14.8619C1.43491 12.9324 0.964742 10.5698 1.41729 8.29367C1.86984 6.01756 3.20803 4.01445 5.13748 2.725H5.13873ZM5.83373 16.2363C6.65256 16.7895 7.57266 17.1755 8.54114 17.372C9.50963 17.5686 10.5074 17.5718 11.4771 17.3814C12.4468 17.1911 13.3694 16.811 14.1918 16.263C15.0141 15.715 15.7201 15.0099 16.269 14.1882C16.818 13.3664 17.1991 12.4443 17.3906 11.4748C17.582 10.5053 17.58 9.50755 17.3846 8.53884C17.1892 7.57013 16.8043 6.64958 16.252 5.83011C15.6996 5.01064 14.9908 4.3084 14.1662 3.76375C12.5122 2.67122 10.4928 2.27796 8.54967 2.66994C6.6065 3.06191 4.89754 4.20723 3.79635 5.85555C2.69516 7.50386 2.29132 9.52109 2.67309 11.4663C3.05487 13.4115 4.19122 15.1264 5.83373 16.2363ZM8.12498 8.75C8.12498 9.08152 7.99329 9.39947 7.75886 9.63389C7.52444 9.86831 7.2065 10 6.87498 10C6.54346 10 6.22552 9.86831 5.9911 9.63389C5.75668 9.39947 5.62498 9.08152 5.62498 8.75C5.62498 8.41848 5.75668 8.10054 5.9911 7.86612C6.22552 7.6317 6.54346 7.5 6.87498 7.5C7.2065 7.5 7.52444 7.6317 7.75886 7.86612C7.99329 8.10054 8.12498 8.41848 8.12498 8.75ZM14.375 8.75C14.375 9.08152 14.2433 9.39947 14.0089 9.63389C13.7744 9.86831 13.4565 10 13.125 10C12.7935 10 12.4755 9.86831 12.2411 9.63389C12.0067 9.39947 11.875 9.08152 11.875 8.75C11.875 8.41848 12.0067 8.10054 12.2411 7.86612C12.4755 7.6317 12.7935 7.5 13.125 7.5C13.4565 7.5 13.7744 7.6317 14.0089 7.86612C14.2433 8.10054 14.375 8.41848 14.375 8.75ZM9.99998 13.75C9.32074 13.7517 8.6538 13.5688 8.07039 13.221C7.48697 12.8731 7.00899 12.3733 6.68748 11.775L5.59998 12.375C6.03767 13.185 6.69048 13.8584 7.48647 14.3209C8.28246 14.7835 9.19072 15.0174 10.1111 14.9967C11.0316 14.976 11.9284 14.7016 12.7028 14.2037C13.4772 13.7058 14.0991 13.0038 14.5 12.175L13.375 11.6375C13.0675 12.271 12.5879 12.8051 11.991 13.1787C11.3941 13.5523 10.7041 13.7503 9.99998 13.75Z"
                fill="#00332C"
              />
            </svg>
            <!-- Text area -->
            <textarea
              name=""
              id=""
              cols="13"
              rows="1"
              class="resize-none h-full focus:outline-none"
              v-model="msg"
              @keyup.enter="addMsg()"
            ></textarea>
          </div>
          <div class="flex items-center gap-x-4">
            <template v-if="writtingMode"
              ><div @click="addMsg()" class="cursor-pointer">
                <svg
                  width="22"
                  height="22"
                  viewBox="0 0 22 22"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M20.8297 10.693L1.2242 0.863296C1.14451 0.823452 1.0531 0.814078 0.966385 0.835171C0.767166 0.88439 0.642947 1.08595 0.692166 1.28751L2.71248 9.5422C2.74295 9.66642 2.83435 9.7672 2.95623 9.80705L6.41795 10.9953L2.95857 12.1836C2.8367 12.2258 2.74529 12.3242 2.71717 12.4485L0.692166 20.7149C0.671072 20.8016 0.680447 20.893 0.720291 20.9703C0.811697 21.1555 1.0367 21.2305 1.2242 21.1391L20.8297 11.3656C20.9023 11.3305 20.9609 11.2695 20.9984 11.1992C21.0898 11.0117 21.0148 10.7867 20.8297 10.693ZM3.0031 18.3664L4.18201 13.5477L11.1008 11.1735C11.1547 11.1547 11.1992 11.1125 11.2179 11.0563C11.2508 10.9578 11.1992 10.8524 11.1008 10.8172L4.18201 8.44533L3.00779 3.64533L17.7265 11.0258L3.0031 18.3664V18.3664Z"
                    fill="black"
                  />
                </svg></div
            ></template>
            <template v-else>
              <!-- File -->
              <svg
                width="18"
                height="19"
                viewBox="0 0 18 19"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M16.865 8.71833L9.20666 16.3767C8.26846 17.3149 6.99598 17.8419 5.66916 17.8419C4.34234 17.8419 3.06987 17.3149 2.13166 16.3767C1.19346 15.4385 0.666382 14.166 0.666382 12.8392C0.666382 11.5123 1.19346 10.2399 2.13166 9.30166L9.79 1.64333C10.4155 1.01786 11.2638 0.666473 12.1483 0.666473C13.0329 0.666473 13.8812 1.01786 14.5067 1.64333C15.1321 2.2688 15.4835 3.11711 15.4835 4.00166C15.4835 4.88621 15.1321 5.73452 14.5067 6.35999L6.84 14.0183C6.68515 14.1732 6.50131 14.296 6.29899 14.3798C6.09667 14.4636 5.87982 14.5068 5.66083 14.5068C5.44184 14.5068 5.22499 14.4636 5.02267 14.3798C4.82035 14.296 4.63651 14.1732 4.48166 14.0183C4.32681 13.8635 4.20398 13.6796 4.12017 13.4773C4.03637 13.275 3.99324 13.0582 3.99324 12.8392C3.99324 12.6202 4.03637 12.4033 4.12017 12.201C4.20398 11.9987 4.32681 11.8148 4.48166 11.66L11.5567 4.59333"
                  stroke="#00332C"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <!-- Photo -->
              <svg
                width="22"
                height="22"
                viewBox="0 0 22 22"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                @click="launchStream"
              >
                <path
                  d="M19.9375 17.875H2.0625C1.88016 17.875 1.7053 17.8026 1.57636 17.6736C1.44743 17.5447 1.375 17.3698 1.375 17.1875V5.5C1.375 5.31766 1.44743 5.1428 1.57636 5.01386C1.7053 4.88493 1.88016 4.8125 2.0625 4.8125H6.50375L7.67938 3.05937C7.74165 2.9648 7.82633 2.88708 7.92588 2.8331C8.02543 2.77913 8.13676 2.75059 8.25 2.75H13.75C13.8632 2.75059 13.9746 2.77913 14.0741 2.8331C14.1737 2.88708 14.2583 2.9648 14.3206 3.05937L15.4963 4.8125H19.9375C20.1198 4.8125 20.2947 4.88493 20.4236 5.01386C20.5526 5.1428 20.625 5.31766 20.625 5.5V17.1875C20.625 17.3698 20.5526 17.5447 20.4236 17.6736C20.2947 17.8026 20.1198 17.875 19.9375 17.875ZM2.75 16.5H19.25V6.1875H15.125C15.0118 6.18691 14.9004 6.15837 14.8009 6.1044C14.7013 6.05042 14.6167 5.9727 14.5544 5.87813L13.3787 4.125H8.62125L7.44562 5.87813C7.38335 5.9727 7.29867 6.05042 7.19912 6.1044C7.09957 6.15837 6.98824 6.18691 6.875 6.1875H2.75V16.5Z"
                  fill="#00332C"
                  fill-opacity="0.95"
                />
                <path
                  d="M11 15.125C10.1842 15.125 9.38663 14.8831 8.70827 14.4298C8.02992 13.9766 7.50121 13.3323 7.189 12.5786C6.87679 11.8248 6.7951 10.9954 6.95426 10.1953C7.11343 9.39508 7.50629 8.66008 8.08319 8.08319C8.66008 7.50629 9.39508 7.11343 10.1953 6.95426C10.9954 6.7951 11.8248 6.87679 12.5786 7.189C13.3323 7.50121 13.9766 8.02992 14.4298 8.70827C14.8831 9.38663 15.125 10.1842 15.125 11C15.125 12.094 14.6904 13.1432 13.9168 13.9168C13.1432 14.6904 12.094 15.125 11 15.125ZM11 8.25C10.4561 8.25 9.92442 8.41129 9.47218 8.71346C9.01995 9.01563 8.66747 9.44513 8.45933 9.94762C8.25119 10.4501 8.19673 11.0031 8.30284 11.5365C8.40895 12.0699 8.67086 12.56 9.05546 12.9445C9.44005 13.3291 9.93006 13.5911 10.4635 13.6972C10.997 13.8033 11.5499 13.7488 12.0524 13.5407C12.5549 13.3325 12.9844 12.9801 13.2865 12.5278C13.5887 12.0756 13.75 11.5439 13.75 11C13.75 10.2707 13.4603 9.57118 12.9445 9.05546C12.4288 8.53973 11.7293 8.25 11 8.25Z"
                  fill="#00332C"
                />
              </svg>
            </template>
          </div>
        </div>
        <!-- Micro -->
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M13.4699 16.575V21.43C13.47 21.514 13.4369 21.5947 13.378 21.6545C13.3191 21.7144 13.2389 21.7487 13.1549 21.75H10.8449C10.7609 21.7487 10.6808 21.7144 10.6219 21.6545C10.563 21.5947 10.5299 21.514 10.5299 21.43V16.575M11.9999 2.25C13.0091 2.25 13.9769 2.65088 14.6905 3.36446C15.4041 4.07803 15.8049 5.04585 15.8049 6.055V10.765C15.8049 11.7741 15.4041 12.742 14.6905 13.4555C13.9769 14.1691 13.0091 14.57 11.9999 14.57V14.57C10.9908 14.57 10.023 14.1691 9.30941 13.4555C8.59583 12.742 8.19495 11.7741 8.19495 10.765V6.055C8.19495 5.04585 8.59583 4.07803 9.30941 3.36446C10.023 2.65088 10.9908 2.25 11.9999 2.25V2.25Z"
            stroke="#00332C"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <path
            d="M6.11499 11.895C6.38552 13.2568 7.11993 14.4826 8.19306 15.3635C9.26619 16.2444 10.6116 16.7259 12 16.7259C13.3884 16.7259 14.7338 16.2444 15.8069 15.3635C16.88 14.4826 17.6145 13.2568 17.885 11.895"
            stroke="#00332C"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>
    </div>
  </div>
</template>
<script setup lang="ts">
import { ref, computed, onMounted, watch } from "vue";
import BatteryIcon from "./components/BatteryIcon.vue";
import NetworkIcon from "./components/NetworkIcon.vue";
import WifiIcon from "./components/WifiIcon.vue";
import MessagesList from "./components/MessagesList.vue";
import Message from "./components/Message.vue";

import { sendReq } from "./utils";

const battery = ref(1);
const charging = ref(false);

const date = new Date(
  new Date().setDate(new Date().getDate())
).toLocaleDateString("en-US", {
  weekday: "long",
  year: "numeric",
  month: "long",
  day: "numeric",
});
const hour = ref(new Date().getHours());
const minute = ref(new Date().getMinutes());
const rtt = ref(0);
const type = ref(null);
const msg = ref("");
const writtingMode = ref(false);

const messages = ref();
const { execute, context } = sendReq();

const streaming = ref(false);
let video = document.querySelector("#video");
navigator.getMedia =
  navigator.getUserMedia ||
  navigator.webkitGetUserMedia ||
  navigator.mozGetUserMedia ||
  navigator.msGetUserMedia;
let width = 320;
let height = 0;

//==============Watchers===============
watch(msg, () => {
  if (msg.value.length > 0) {
    writtingMode.value = true;
  } else {
    writtingMode.value = false;
  }
});

onMounted(async () => {
  video = document.querySelector("#video");
  messages.value = [
    {
      msg: "Je suis Séréna, une IA créée par Epoundor pour bavarder avec ses amis facilement. Comment puis-je vous aider aujourd'hui ?",
      mine: false,
      time: parseTime,
    },
  ];

  const t = new Date();
  setInterval(async () => {
    hour.value = new Date().getHours();
    minute.value = new Date().getMinutes();
    rtt.value = navigator.connection.rtt;
    type.value = navigator.connection.effectiveType;
    await navigator.getBattery().then((res: any) => {
      battery.value = res.level;
      charging.value = res.charging;
    });
  }, 500);
});

async function addMsg() {
  const value = msg.value.trim();
  if (value) {
    messages.value.push({
      msg: value,
      mine: true,
      time: parseTime,
    });
    scrollBottom();
    msg.value = "";
    await execute(value);
    context.completion.forEach((el) => {
      messages.value.push({
        msg: el.text,
        mine: false,
        time: parseTime,
      });
      scrollBottom();
    });
  }
}
function launchStream() {
  if (video && !streaming.value) {
    navigator.getMedia(
      {
        video: true,
        audio: true,
      },
      function (stream: Blob | MediaSource) {
        if (navigator.mozGetUserMedia) {
          video!.mozSrcObject = stream;
        } else {
          console.log(stream);
          streaming.value = true;
          video!.srcObject = stream;
        }
        video!.play();
        console.log(stream);
      },
      function (err: string) {
        console.log("An error occured! " + err);
      }
    );
  } else {
    console.log("stream");
  }
}
if (video !== null) {
  video.addEventListener(
    "canplay",
    (ev: any) => {
      console.log("object");
      if (!streaming.value) {
        height = video.videoHeight / (video.videoWidth / width);
        video.setAttribute("width", width);
        video.setAttribute("height", height);
        canvas.setAttribute("width", width);
        canvas.setAttribute("height", height);
      }
    },
    false
  );
}

function scrollBottom() {
  const el = document.querySelector("#msg-list");
  if (el) {
    console.log(el.scrollTop, el.scrollHeight);
    el.scrollTop = el.scrollHeight;
    console.log(el.scrollTop, el.scrollHeight);
    console.log("object");
  }
  console.log(context.completion);
}
const parseTime = computed(() => {
  return (
    hour.value.toString().padStart(2, 0) +
    ":" +
    minute.value.toString().padStart(2, 0)
  );
});
</script>

<style scoped>
.phone {
  box-shadow: 0px 0px 24px rgba(0, 0, 0, 0.25);
}
</style>
